---
import { getCollection } from 'astro:content'
import MarketingLayout from '@/layouts/MarketingLayout.astro'
import Hero from '@/components/marketing/Hero.astro'
import StatStrip from '@/components/marketing/StatStrip.astro'
import Section from '@/components/marketing/Section.astro'
import FeatureGrid from '@/components/marketing/FeatureGrid.astro'
import CtaBanner from '@/components/marketing/CtaBanner.astro'
import PlatformMapSection from '@/components/marketing/PlatformMapSection.astro'
import ProofPointCard from '@/components/marketing/ProofPointCard.astro'

export async function getStaticPaths() {
  const solutions = await getCollection('solutions')
  return solutions.map((solution) => ({
    params: { slug: solution.id.replace(/\.md$/, '') },
    props: { solution },
  }))
}

const { solution } = Astro.props
const { Content } = await solution.render()
const { title, tagline, description, hero, challenges, capabilities, stats, platformMapping, proofPoint, cta } = solution.data

// Default CTA values
const ctaPrimary = cta?.primary || { label: 'Schedule a Demo', href: '/contact/demo' }
const ctaSecondary = cta?.secondary || { label: 'Talk to Sales', href: '/contact/sales' }
---

<MarketingLayout
  title={`${title} â€” ${tagline}`}
  description={description}
>
  <Hero
    eyebrow={hero.eyebrow}
    title={hero.title}
    description={hero.description}
    primaryCta={hero.primaryCta}
    secondaryCta={hero.secondaryCta}
  />

  <StatStrip stats={stats} />

  <!-- Challenges Grid -->
  <Section>
    <FeatureGrid
      title="The Challenge"
      subtitle="Critical operational pain points this solution addresses."
      features={challenges.map(c => ({ name: c.title, description: c.description }))}
      columns={challenges.length === 4 ? 4 : challenges.length === 3 ? 3 : 2}
    />
  </Section>

  <!-- Capabilities Grid -->
  <Section class="bg-neutral-800/2.5">
    <FeatureGrid
      title="Key Capabilities"
      subtitle={`Everything you need for ${title.toLowerCase()}.`}
      features={capabilities.map(c => ({ name: c.name, description: c.description }))}
      columns={3}
    />
  </Section>

  <!-- Platform Mapping -->
  {platformMapping && (
    <PlatformMapSection
      connect={platformMapping.connect}
      operate={platformMapping.operate}
      command={platformMapping.command}
    />
  )}

  <!-- Proof Point -->
  {proofPoint && (
    <Section>
      <div class="text-center mb-12">
        <h2 class="font-display text-2xl font-bold tracking-tight text-neutral-800 sm:text-3xl">Proven Results</h2>
        <p class="mt-4 text-lg text-neutral-600">Real outcomes from organizations like yours.</p>
      </div>
      <div class="mx-auto max-w-3xl">
        <ProofPointCard
          industryLabel={proofPoint.industry}
          headline={proofPoint.headline}
          metrics={proofPoint.metrics}
          narrative={proofPoint.narrative}
          cta={{ label: 'Read the full case study', href: '/resources/case-studies' }}
        />
      </div>
    </Section>
  )}

  <CtaBanner
    title={`Ready for ${title}?`}
    description={`See how Quatro delivers ${title.toLowerCase()} for your operations.`}
    primaryCta={ctaPrimary}
    secondaryCta={ctaSecondary}
    microcopy={cta?.microcopy}
  />
</MarketingLayout>
