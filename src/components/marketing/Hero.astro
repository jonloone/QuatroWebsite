---
import Button from '@/components/ui/Button.astro'
import Container from '@/components/ui/Container.astro'

interface Props {
  eyebrow?: string
  title: string
  description?: string
  primaryCta?: { label: string; href: string }
  microcopy?: string
  variant?: 'light' | 'dark'
  class?: string
}

const {
  eyebrow,
  title,
  description,
  primaryCta,
  microcopy,
  variant = 'light',
  class: className,
} = Astro.props

const isLight = variant === 'light'
---

<section data-hero-section class:list={['flex flex-col gap-16 px-2 pb-16', className]}>
  {isLight ? (
    <!-- Light variant: neutral background, monospaced eyebrow -->
    <div class="relative overflow-hidden bg-neutral-100 min-h-[600px] lg:min-h-[700px]">
      <div class="relative -mx-2 sm:px-6 md:px-12 lg:px-0">
        <Container>
          <!-- Text Content -->
          <div data-hero-text class="flex shrink-0 flex-col items-start gap-6 py-16 sm:py-24 lg:py-32 lg:max-w-xl xl:max-w-2xl">
            {eyebrow && (
              <div class="font-mono text-[10px] uppercase tracking-[0.1em] text-neutral-500">
                {eyebrow}
              </div>
            )}
            <h1 class="max-w-5xl font-display text-4xl tracking-tight text-neutral-800 sm:text-5xl lg:text-6xl">
              {title}
            </h1>
            {description && (
              <div class="flex max-w-xl flex-col gap-4 text-lg/7 text-neutral-600">
                {description}
              </div>
            )}
            {primaryCta && (
              <div class="flex flex-col items-start gap-3">
                <Button href={primaryCta.href} size="lg" color="dark">
                  {primaryCta.label}
                </Button>
                {microcopy && (
                  <div class="text-sm text-neutral-500">{microcopy}</div>
                )}
              </div>
            )}
          </div>

          <!-- Demo slot: positioned below CTA, centered -->
          <div class="mx-auto max-w-4xl pb-8">
            <slot name="demo" />
          </div>
        </Container>
      </div>
    </div>
  ) : (
    <!-- Dark variant: dark background with image overlay -->
    <div
      class="relative overflow-hidden bg-cover bg-center min-h-[600px] lg:min-h-[700px]"
      style="background-image: url('/images/bg555.png')"
    >
      <!-- Dark overlay for text legibility -->
      <div class="absolute inset-0 bg-neutral-900/60"></div>

      <!-- Hero image - anchored to bottom right, sized to fill -->
      <div class="absolute bottom-0 right-0 w-[60%] max-w-5xl pointer-events-none hidden lg:block">
        <slot name="demo" />
      </div>

      <div class="relative -mx-2 sm:px-6 md:px-12 lg:px-0">
        <Container>
          <!-- Text Content -->
          <div data-hero-text class="flex shrink-0 flex-col items-start gap-6 py-16 sm:py-24 lg:py-32 lg:max-w-xl xl:max-w-2xl">
            {eyebrow && (
              <div class="font-mono text-[10px] uppercase tracking-[0.1em] text-white/90">
                {eyebrow}
              </div>
            )}
            <h1 class="max-w-5xl font-display text-4xl tracking-tight text-white sm:text-5xl lg:text-6xl">
              {title}
            </h1>
            {description && (
              <div class="flex max-w-xl flex-col gap-4 text-lg/7 text-white/70">
                {description}
              </div>
            )}
            {primaryCta && (
              <div class="flex flex-col items-start gap-3">
                <Button href={primaryCta.href} size="lg">
                  {primaryCta.label}
                </Button>
                {microcopy && (
                  <div class="text-sm text-white/50">{microcopy}</div>
                )}
              </div>
            )}
          </div>
        </Container>
      </div>
    </div>
  )}
  <slot name="footer" />
</section>

<script>
  const heroSection = document.querySelector('[data-hero-section]');
  const heroText = document.querySelector('[data-hero-text]');
  if (heroSection && heroText) {
    const heroHeight = heroSection.getBoundingClientRect().height;
    let ticking = false;
    window.addEventListener('scroll', () => {
      if (!ticking) {
        requestAnimationFrame(() => {
          const scrollY = window.scrollY;
          if (scrollY < heroHeight) {
            const progress = Math.min(scrollY / (heroHeight * 0.6), 1);
            (heroText as HTMLElement).style.transform = `translateY(${-scrollY * 0.3}px)`;
            (heroText as HTMLElement).style.opacity = String(1 - progress);
          }
          ticking = false;
        });
        ticking = true;
      }
    }, { passive: true });
  }
</script>
